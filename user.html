<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nearby Bazar</title>
    <meta name="theme-color" content="#0f0f0f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* --- SGMC ORIGINAL THEME --- */
        :root { --bg: #050505; --card: #141414; --border: #333; --accent: #F97316; --text: #fff; --glass: rgba(30, 30, 30, 0.6); }
        body { background-color: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; padding-bottom: 80px; -webkit-tap-highlight-color: transparent; }
        
        /* 1. HOME SCREEN STYLES */
        .shop-card { background: #1a1a1a; border: 1px solid #333; border-radius: 16px; padding: 16px; margin-bottom: 12px; position: relative; transition: 0.2s; }
        .shop-card:active { transform: scale(0.98); }
        .live-badge { position: absolute; top: 10px; right: 10px; background: rgba(34, 197, 94, 0.2); color: #4ade80; border: 1px solid rgba(34, 197, 94, 0.3); padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; }
        .closed-badge { position: absolute; top: 10px; right: 10px; background: rgba(239, 68, 68, 0.2); color: #f87171; border: 1px solid rgba(239, 68, 68, 0.3); padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; }

        /* 2. SGMC SHOP STYLES (Glassmorphism) */
        .glass-card { background: var(--glass); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 16px; overflow: hidden; margin-bottom: 12px; }
        .item-thumb { width: 50px; height: 50px; object-fit: cover; border-radius: 8px; background: #222; }
        
        /* Modals & Overlays */
        .fs-modal { position: fixed; inset: 0; background: var(--bg); z-index: 100; transform: translateX(100%); transition: 0.3s; overflow-y: auto; }
        .fs-modal.open { transform: translateX(0); }
        
        .popup-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 200; display: none; align-items: center; justify-content: center; opacity: 0; transition: 0.3s; }
        .popup-overlay.open { display: flex; opacity: 1; pointer-events: auto; }
        .popup-card { background: #151515; border: 1px solid #333; width: 90%; max-width: 350px; border-radius: 20px; padding: 20px; position: relative; }

        /* Sidebar */
        .sidebar { position: fixed; top: 0; left: 0; bottom: 0; width: 280px; background: #0f0f0f; z-index: 300; transform: translateX(-100%); transition: 0.3s; border-right: 1px solid #333; box-shadow: 10px 0 30px rgba(0,0,0,0.5); }
        .sidebar.open { transform: translateX(0); }
        .sidebar-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 290; display: none; }
        .sidebar-overlay.open { display: block; }
        
        /* Auth */
        #auth-screen { position: fixed; inset: 0; background: #000; z-index: 1000; display: flex; flex-direction: column; justify-content: center; padding: 24px; }
        input { background: #222; border: 1px solid #444; color: white; padding: 14px; width: 100%; border-radius: 12px; margin-bottom: 12px; outline: none; }
        .btn-primary { background: linear-gradient(to right, #ea580c, #c2410c); color: white; padding: 14px; border-radius: 12px; font-weight: bold; width: 100%; }

        /* Cart Bar */
        #cart-bar { position: fixed; bottom: 30px; left: 15px; right: 15px; background: linear-gradient(to right, #ea580c, #ca8a04); color: white; padding: 12px 20px; border-radius: 12px; display: none; justify-content: space-between; align-items: center; box-shadow: 0 10px 20px rgba(0,0,0,0.4); z-index: 40; cursor: pointer; animation: slideUp 0.3s; }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="text-center mb-10">
            <h1 class="text-4xl font-bold text-orange-500 mb-2">Nearby Bazar</h1>
            <p class="text-gray-500 text-sm">Customer Login</p>
        </div>
        <input type="text" id="user-name" placeholder="Your Name">
        <input type="tel" id="user-phone" placeholder="Phone Number">
        <button onclick="login()" class="btn-primary">Continue</button>
    </div>

    <div id="view-home" class="hidden">
        <div class="sticky top-0 bg-[#050505]/95 backdrop-blur-md p-4 border-b border-[#333] flex justify-between items-center z-40">
            <button onclick="toggleMainSidebar()" class="w-10 h-10 rounded-full bg-gray-900 text-white"><i class="fas fa-bars"></i></button>
            <div>
                <h1 class="text-lg font-bold text-orange-500 text-center">Nearby Bazar</h1>
                <p class="text-[10px] text-gray-400 text-center" id="loc-status">Detecting...</p>
            </div>
            <div class="w-10"></div>
        </div>
        <div id="shops-list" class="p-4 space-y-3">
            <div class="text-center text-gray-600 mt-20"><i class="fas fa-circle-notch fa-spin"></i> Loading...</div>
        </div>
    </div>

    <div id="view-shop" class="fs-modal bg-[#050505] p-0">
        <div class="fixed top-0 left-0 right-0 bg-[#050505]/95 backdrop-blur-sm z-40 px-4 py-4 flex justify-between items-center border-b border-white/5">
            <button onclick="closeShop()" class="w-10 h-10 rounded-full flex items-center justify-center text-gray-400 bg-[#111]"><i class="fas fa-arrow-left"></i></button>
            <div>
                <h1 class="text-xl font-bold text-white" id="shop-title">Shop</h1>
                <p class="text-[10px] text-green-500 font-bold tracking-wide pl-0.5 text-center">‚óè LIVE STORE</p>
            </div>
            <button onclick="toggleShopSidebar()" class="w-10 h-10 rounded-full flex items-center justify-center text-orange-500 border border-gray-800 bg-[#111]"><i class="fas fa-bars"></i></button>
        </div>

        <div class="h-20"></div>

        <div id="menu-container" class="p-4 space-y-4 pb-32"></div>

        <div id="cart-bar" onclick="openCheckout()">
            <div class="flex items-center gap-3">
                <div class="bg-white text-orange-600 w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm" id="cart-count">0</div>
                <div><p class="text-[10px] uppercase font-bold text-orange-100 opacity-80">Total</p><span class="font-bold text-lg">‚Çπ<span id="cart-total">0</span></span></div>
            </div>
            <span class="font-bold text-sm flex items-center gap-2">Checkout <i class="fas fa-arrow-right"></i></span>
        </div>
    </div>

    <div id="sidebar-overlay" class="sidebar-overlay" onclick="closeSidebars()"></div>
    
    <div id="sidebar-main" class="sidebar p-6 flex flex-col h-full">
        <div class="mb-8">
            <h2 class="text-xl font-bold text-orange-500 mb-1" id="sb-user">User</h2>
            <p class="text-xs text-gray-500" id="sb-phone">+91...</p>
        </div>
        <div class="space-y-4">
            <button onclick="showAllOrders()" class="text-gray-300 font-bold flex gap-3 items-center"><i class="fas fa-receipt w-6"></i> All Orders</button>
            <button onclick="shareApp()" class="text-gray-300 font-bold flex gap-3 items-center"><i class="fas fa-share-alt w-6"></i> Share App</button>
        </div>
        <button onclick="logout()" class="text-red-500 font-bold mt-auto flex gap-3 items-center"><i class="fas fa-sign-out-alt"></i> Logout</button>
    </div>

    <div id="sidebar-shop" class="sidebar p-6 flex flex-col h-full">
        <div class="mb-8">
            <h2 class="text-xl font-bold text-orange-500 mb-1" id="sb-shop-name">Shop</h2>
            <p class="text-xs text-green-500">‚óè Verified Partner</p>
        </div>
        <div class="space-y-4">
            <button onclick="showShopOrders()" class="text-gray-300 font-bold flex gap-3 items-center"><i class="fas fa-history w-6"></i> Order History</button>
            <button onclick="alert('Chat coming soon')" class="text-gray-300 font-bold flex gap-3 items-center"><i class="fas fa-comments w-6"></i> Chat Support</button>
        </div>
    </div>

    <div id="checkout-modal" class="popup-overlay" style="align-items: flex-end;">
        <div class="bg-[#151515] w-full max-w-md p-6 rounded-t-3xl border-t border-[#333] shadow-2xl max-h-[90vh] overflow-y-auto relative">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-white">Checkout</h2>
                <button onclick="document.getElementById('checkout-modal').classList.remove('open')" class="w-8 h-8 rounded-full bg-[#222] text-gray-400 flex items-center justify-center"><i class="fas fa-times"></i></button>
            </div>
            
            <div id="checkout-items" class="space-y-3 mb-6"></div>
            
            <div class="glass-card p-4 border border-gray-700/50 mb-4">
                <div class="flex bg-[#222] p-1 rounded-xl mb-4">
                    <button onclick="toggleOrderType('self')" id="tab-self" class="flex-1 py-2 rounded-lg text-xs font-bold text-white bg-orange-600">Self Order</button>
                    <button onclick="toggleOrderType('others')" id="tab-others" class="flex-1 py-2 rounded-lg text-xs font-bold text-gray-400">Others</button>
                </div>
                <div id="form-self">
                    <div class="flex items-center justify-between mb-2"><p class="text-[10px] font-bold text-orange-500">LOCATION</p><button onclick="detectLocation()" class="text-xs text-blue-400 font-bold"><i class="fas fa-crosshairs"></i> Detect</button></div>
                    <div class="flex gap-2"><input id="addr-flat" placeholder="Flat / Room No" class="text-xs"><input id="addr-land" placeholder="Landmark" class="text-xs"></div>
                </div>
                <div id="form-others" class="hidden">
                    <input id="rec-name" placeholder="Receiver Name" class="text-xs mb-2">
                    <input id="rec-phone" type="tel" placeholder="Receiver Phone" class="text-xs mb-2">
                    <input id="rec-addr" placeholder="Full Address" class="text-xs">
                </div>
            </div>

            <div><label class="text-[10px] font-bold text-gray-500 mb-2 block">PAYMENT</label>
                <div class="grid grid-cols-3 gap-3 mb-4">
                    <button onclick="setPayment('Cash')" id="pay-cash" class="p-3 rounded-xl border border-gray-700 bg-gray-800 text-xs font-bold text-gray-300">Cash</button>
                    <button onclick="setPayment('UPI')" id="pay-upi" class="p-3 rounded-xl border border-gray-700 bg-gray-800 text-xs font-bold text-gray-300">UPI</button>
                    <button onclick="setPayment('Udhaar')" id="pay-udhaar" class="p-3 rounded-xl border border-gray-700 bg-gray-800 text-xs font-bold text-gray-300">Udhaar</button>
                </div>
            </div>

            <div class="flex justify-between items-center pt-4 border-t border-[#333]">
                <div><p class="text-xs text-gray-500">Total</p><span class="text-white font-bold text-xl">‚Çπ<span id="co-total">0</span></span></div>
                <button onclick="placeOrder()" class="bg-gradient-to-r from-orange-600 to-orange-500 text-white px-8 py-3 rounded-xl font-bold shadow-lg">Place Order</button>
            </div>
        </div>
    </div>

    <div id="history-modal" class="popup-overlay">
        <div class="bg-[#151515] w-full max-w-md h-[80vh] p-4 rounded-xl relative flex flex-col">
            <div class="flex justify-between items-center mb-4 border-b border-gray-800 pb-2">
                <h3 class="font-bold text-white text-lg" id="hist-title">Orders</h3>
                <button onclick="document.getElementById('history-modal').classList.remove('open')" class="text-gray-400 text-xl"><i class="fas fa-times"></i></button>
            </div>
            <div id="history-content" class="flex-1 overflow-y-auto space-y-3"></div>
        </div>
    </div>

    <div id="order-detail-popup" class="popup-overlay">
        <div class="bg-[#1f1f1f] w-full max-w-sm p-6 rounded-2xl border border-gray-700 relative">
            <button onclick="document.getElementById('order-detail-popup').classList.remove('open')" class="absolute top-4 right-4 text-gray-400"><i class="fas fa-times"></i></button>
            <h2 class="text-lg font-bold mb-1 text-white">Details</h2>
            <p id="od-status" class="text-xs uppercase font-bold text-orange-500 mb-4">Pending</p>
            <div id="od-items" class="bg-gray-900/50 rounded p-2 max-h-40 overflow-y-auto mb-2 space-y-1"></div>
            <div class="pt-2 border-t border-gray-700 font-bold flex justify-between text-white"><span>Total</span><span id="od-total" class="text-orange-500"></span></div>
        </div>
    </div>

    <div id="cooking-screen" class="fixed inset-0 bg-black z-[200] hidden flex-col items-center justify-center">
        <i class="fas fa-mug-hot text-6xl text-orange-500 mb-6 block animate-pulse"></i>
        <h2 class="text-2xl font-bold mb-2 text-white">Order Sent!</h2>
        <p class="text-gray-400 text-sm">Shop will confirm shortly...</p>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyBadYpoNTL0dHkBQO4UddRVtPIfUOlf-bA", authDomain: "nearby-bazar.firebaseapp.com", projectId: "nearby-bazar", storageBucket: "nearby-bazar.firebasestorage.app", messagingSenderId: "183262510084", appId: "1:183262510084:web:85d9a50a3b51b30aae351f", measurementId: "G-4996NPF55N" };
        firebase.initializeApp(firebaseConfig); const db = firebase.firestore();

        let USER = JSON.parse(localStorage.getItem('nb_user'));
        let currentLocation = null;
        let activeShop = null; // Currently opened shop object
        let cart = [];
        let payMode = 'Cash';
        let isSelf = true;

        // --- AUTH ---
        if(USER) {
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('view-home').classList.remove('hidden');
            document.getElementById('sb-user').innerText = USER.name;
            document.getElementById('sb-phone').innerText = USER.phone;
            initHome();
        } else {
            document.getElementById('auth-screen').style.display = 'flex';
        }

        function login() {
            const name = document.getElementById('user-name').value.trim();
            const phone = document.getElementById('user-phone').value.trim();
            if(name && phone.length===10) {
                USER = { name, phone };
                localStorage.setItem('nb_user', JSON.stringify(USER));
                location.reload();
            } else alert("Invalid Input");
        }
        function logout() { localStorage.removeItem('nb_user'); location.reload(); }

        // --- HOME ---
        function initHome() {
            navigator.geolocation.getCurrentPosition(p => {
                currentLocation = { lat: p.coords.latitude, lng: p.coords.longitude };
                document.getElementById('loc-status').innerText = "GPS Active";
                loadShops();
            }, () => {
                document.getElementById('loc-status').innerText = "GPS Failed - Showing All";
                loadShops();
            });
        }

        function loadShops() {
            db.collection('shops').where('status', '==', 'verified').onSnapshot(snap => {
                const list = document.getElementById('shops-list');
                list.innerHTML = "";
                snap.forEach(doc => {
                    const s = doc.data();
                    let dist = "Unknown";
                    if(currentLocation && s.location) {
                        dist = getDistance(currentLocation.lat, currentLocation.lng, s.location.lat, s.location.lng).toFixed(1) + " km";
                    }
                    
                    list.innerHTML += `
                    <div class="shop-card flex justify-between items-center" onclick="openShop('${doc.id}', '${s.shopName}', ${s.isOpen})">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full bg-gray-800 flex items-center justify-center text-xl">üè™</div>
                            <div>
                                <h2 class="font-bold text-white text-lg">${s.shopName}</h2>
                                <p class="text-xs text-gray-400">${dist} ‚Ä¢ ${s.ownerName}</p>
                            </div>
                        </div>
                        <span class="${s.isOpen ? 'live-badge' : 'closed-badge'}">${s.isOpen ? 'LIVE' : 'CLOSED'}</span>
                    </div>`;
                });
            });
        }

        // --- SHOP VIEW ---
        async function openShop(id, name, isOpen) {
            if(!isOpen) return alert("Shop is Closed!");
            const docSnap = await db.collection('shops').doc(id).get();
            activeShop = { id, ...docSnap.data() };
            
            document.getElementById('shop-title').innerText = name;
            document.getElementById('sb-shop-name').innerText = name;
            document.getElementById('view-shop').classList.add('open');
            
            db.collection('shops').doc(id).collection('inventory').where('available', '==', true).onSnapshot(snap => {
                const list = document.getElementById('menu-container');
                list.innerHTML = snap.docs.map(doc => {
                    const i = doc.data();
                    return `
                    <div class="glass-card p-4 flex justify-between items-center mb-3">
                        <div class="flex gap-3 items-center">
                            ${i.image ? `<img src="${i.image}" class="item-thumb">` : '<div class="item-thumb bg-gray-800"></div>'}
                            <div>
                                <h3 class="font-bold text-sm text-white">${i.name}</h3>
                                <p class="text-orange-400 text-xs font-bold">‚Çπ${i.price}</p>
                            </div>
                        </div>
                        <button onclick="addToCart('${doc.id}', '${i.name}', ${i.price})" class="bg-gray-800 text-white px-4 py-2 rounded text-xs font-bold border border-gray-700">ADD</button>
                    </div>`;
                }).join('');
            });
            cart = []; updateCartUI();
        }

        function closeShop() { document.getElementById('view-shop').classList.remove('open'); cart=[]; updateCartUI(); }

        // --- CART & CHECKOUT ---
        function addToCart(id, name, price) {
            const ex = cart.find(x => x.id === id);
            if(ex) ex.qty++; else cart.push({id, name, price, qty: 1});
            updateCartUI();
        }
        function updateCartUI() {
            const bar = document.getElementById('cart-bar');
            const total = cart.reduce((a,b) => a+(b.price*b.qty), 0);
            const count = cart.reduce((a,b) => a+b.qty, 0);
            document.getElementById('cart-total').innerText = total;
            document.getElementById('cart-count').innerText = count;
            bar.style.display = count > 0 ? 'flex' : 'none';
        }

        function openCheckout() {
            if(!cart.length) return;
            // Render items in modal
            document.getElementById('checkout-items').innerHTML = cart.map(i => `<div class="flex justify-between text-sm text-gray-300"><span>${i.name} x${i.qty}</span><span>‚Çπ${i.price*i.qty}</span></div>`).join('');
            document.getElementById('co-total').innerText = cart.reduce((a,b) => a+(b.price*b.qty), 0);
            document.getElementById('checkout-modal').classList.add('open');
        }
        function closeCheckout() { document.getElementById('checkout-modal').classList.remove('open'); }

        function toggleOrderType(t) {
            isSelf = t==='self';
            document.getElementById('tab-self').className = isSelf ? "flex-1 py-2 rounded-lg text-xs font-bold text-white bg-orange-600" : "flex-1 py-2 rounded-lg text-xs font-bold text-gray-400";
            document.getElementById('tab-others').className = !isSelf ? "flex-1 py-2 rounded-lg text-xs font-bold text-white bg-orange-600" : "flex-1 py-2 rounded-lg text-xs font-bold text-gray-400";
            document.getElementById('form-self').classList.toggle('hidden', !isSelf);
            document.getElementById('form-others').classList.toggle('hidden', isSelf);
        }
        function setPayment(m) {
            payMode = m;
            ['Cash','UPI','Udhaar'].forEach(x => {
                const el = document.getElementById('pay-'+x.toLowerCase());
                el.className = "p-3 rounded-xl border border-gray-700 bg-gray-800 text-xs font-bold text-gray-300";
            });
            document.getElementById('pay-'+m.toLowerCase()).className = "p-3 rounded-xl border border-green-500 bg-green-600 text-xs font-bold text-white";
        }
        
        function detectLocation() {
            navigator.geolocation.getCurrentPosition(p => {
                currentLocation = {lat: p.coords.latitude, lng: p.coords.longitude};
                document.getElementById('addr-flat').placeholder = "Loc Detected! Enter Flat No";
            });
        }

        async function placeOrder() {
            const addr = isSelf ? `${document.getElementById('addr-flat').value}, ${document.getElementById('addr-land').value}` : document.getElementById('rec-addr').value;
            if(!addr) return alert("Enter Address");
            
            const total = cart.reduce((a,b) => a+(b.price*b.qty), 0);
            const orderData = {
                shopId: activeShop.id,
                items: cart,
                totalAmount: total,
                paymentMode: payMode,
                status: 'pending',
                customerName: USER.name,
                customerPhone: USER.phone,
                customerAddress: addr,
                customerCoordinates: currentLocation,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };

            if(payMode === 'UPI') {
                window.location.href = `upi://pay?pa=${activeShop.upiId}&pn=${activeShop.shopName}&am=${total}&cu=INR`;
            }

            await db.collection('orders').add(orderData);
            closeCheckout();
            document.getElementById('cooking-screen').style.display = 'flex';
            setTimeout(() => {
                document.getElementById('cooking-screen').style.display = 'none';
                closeShop();
            }, 2500);
        }

        // --- HISTORY & SIDEBARS ---
        function toggleMainSidebar() { 
            document.getElementById('sidebar-main').classList.toggle('open'); 
            document.getElementById('sidebar-overlay').classList.toggle('open');
            document.getElementById('sidebar-overlay').style.display = document.getElementById('sidebar-main').classList.contains('open') ? 'block' : 'none';
        }
        
        function toggleShopSidebar() {
            document.getElementById('sidebar-shop').classList.toggle('open');
            document.getElementById('sidebar-overlay').classList.toggle('open');
            document.getElementById('sidebar-overlay').style.display = document.getElementById('sidebar-shop').classList.contains('open') ? 'block' : 'none';
        }

        function closeSidebars() {
            document.getElementById('sidebar-main').classList.remove('open');
            document.getElementById('sidebar-shop').classList.remove('open');
            document.getElementById('sidebar-overlay').classList.remove('open');
            document.getElementById('sidebar-overlay').style.display = 'none';
        }

        function showAllOrders() {
            renderHistory(db.collection('orders').where('customerPhone', '==', USER.phone));
            closeSidebars();
        }
        function showShopOrders() {
            renderHistory(db.collection('orders').where('customerPhone', '==', USER.phone).where('shopId', '==', activeShop.id));
            closeSidebars();
        }

        function renderHistory(q) {
            document.getElementById('history-modal').classList.add('open');
            q.orderBy('timestamp', 'desc').onSnapshot(snap => {
                document.getElementById('history-content').innerHTML = snap.docs.map(doc => {
                    const d = doc.data();
                    return `<div class="glass-card p-3" onclick="showOrderDetail('${doc.id}', '${d.totalAmount}', '${d.status}', '${escape(JSON.stringify(d.items))}')">
                        <div class="flex justify-between mb-1"><span class="font-bold text-white text-sm">‚Çπ${d.totalAmount}</span><span class="text-xs text-orange-400 uppercase">${d.status}</span></div>
                        <p class="text-xs text-gray-500">${new Date(d.timestamp?.toDate()).toLocaleDateString()}</p>
                    </div>`;
                }).join('');
            });
        }

        function showOrderDetail(id, total, status, itemsStr) {
            const items = JSON.parse(unescape(itemsStr));
            document.getElementById('od-total').innerText = '‚Çπ' + total;
            document.getElementById('od-status').innerText = status;
            document.getElementById('od-items').innerHTML = items.map(i => `<div class="flex justify-between text-sm text-gray-300"><span>${i.name} x${i.qty}</span><span>‚Çπ${i.price*i.qty}</span></div>`).join('');
            document.getElementById('order-detail-popup').classList.add('open');
        }

        function getDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; 
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c; 
        }
        function shareApp() { if(navigator.share) navigator.share({title:'Nearby Bazar', url:window.location.href}); }
    </script>
</body>
</html>
